(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.ColsSortable=function(t){this.parent=null;this.dragItem=null;this.targetItem=null;this.rowsList=null;this.colsList=null;this.dragRect=null;this.offset=null;this.startDragOffset=null;this.dragColumn=null;this.targetColumn=null;this.isDrag=null;this.init(t)};BX.Grid.ColsSortable.prototype={init:function(t){var s,i;var e=this;this.parent=t;this.colsList=this.getColsList();this.rowsList=this.parent.getRows().getSourceRows();if(this.isPinned&&this.parent.getParam("ALLOW_PIN_HEADER")){s=this.parent.getPinHeader().getFixedTable();i=BX.Grid.Utils.getByTag(s,"tr");(i||[]).forEach(function(t){e.rowsList.push(t)})}this.registerObjects();if(!this.inited){this.inited=true;BX.addCustomEvent("Grid::headerPinned",BX.delegate(this._onPin,this));BX.addCustomEvent("Grid::headerUnpinned",BX.delegate(this._onUnpin,this))}},_onPin:function(){this.isPinned=true;this.reinit()},_onUnpin:function(){this.isPinned=false;this.reinit()},reinit:function(){this.unregisterObjects();this.reset();this.init(this.parent)},reset:function(){this.dragItem=null;this.targetItem=null;this.rowsList=null;this.colsList=null;this.dragRect=null;this.offset=null;this.startDragOffset=null;this.dragColumn=null;this.targetColumn=null;this.isDrag=null},isActive:function(){return this.isDrag},registerObjects:function(t){var s=this;[].forEach.call(t||this.colsList,function(t){t.onbxdragstart=BX.delegate(s._onDragStart,s);t.onbxdrag=BX.delegate(s._onDrag,s);t.onbxdragstop=BX.delegate(s._onDragEnd,s);jsDD.registerObject(t);jsDD.registerDest(t)})},unregisterObjects:function(){[].forEach.call(this.colsList,function(t){jsDD.unregisterObject(t);jsDD.unregisterDest(t)})},getColsList:function(){var t=this;var s=[];var i;if(this.isPinned&&this.parent.getParam("ALLOW_PIN_HEADER")){i=this.parent.getPinHeader().getFixedTable();s=BX.Grid.Utils.getByTag(i,"th")}else{s=this.parent.getRows().getHeadFirstChild().getCells()}s=[].filter.call(s,function(s){return!t.isStatic(s)});return s},isStatic:function(t){return BX.hasClass(t,this.parent.settings.get("classCellStatic"))},getDragOffset:function(){return jsDD.x-this.startDragOffset-this.dragRect.left},getColumn:function(t){var s=BX.Grid.Utils.getColumn(this.parent.getTable(),t);if(s.indexOf(t)===-1){s.push(t)}return s},_onDragStart:function(){this.isDrag=true;this.dragItem=jsDD.current_node;this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.width;this.startDragOffset=jsDD.start_x-this.dragRect.left;this.dragColumn=this.getColumn(this.dragItem);this.dragIndex=BX.Grid.Utils.getIndex(this.colsList,this.dragItem)},_onDrag:function(){var t,s;var i=this;this.dragOffset=this.getDragOffset();this.targetItem=this.targetItem||this.dragItem;this.targetColumn=this.targetColumn||this.dragColumn;BX.Grid.Utils.styleForEach(this.dragColumn,{transition:"0ms",transform:"translate3d("+this.dragOffset+"px, 0px, 0px)"});[].forEach.call(this.colsList,function(e,n){if(e){t=e.getBoundingClientRect();s=t.left+t.width/2+BX.scrollLeft(window);if(n>i.dragIndex&&jsDD.x>s&&e.style.transform!=="translate3d("+-i.offset+"px, 0px, 0px)"){i.targetColumn=i.getColumn(e);BX.Grid.Utils.styleForEach(i.targetColumn,{transition:"300ms",transform:"translate3d("+-i.offset+"px, 0px, 0px)"})}if(n<i.dragIndex&&jsDD.x<s&&e.style.transform!=="translate3d("+i.offset+"px, 0px, 0px)"){i.targetColumn=i.getColumn(e);BX.Grid.Utils.styleForEach(i.targetColumn,{transition:"300ms",transform:"translate3d("+i.offset+"px, 0px, 0px)"})}if(n>i.dragIndex&&jsDD.x<s&&e.style.transform!==""&&e.style.transform!=="translate3d(0px, 0px, 0px)"||e.style.transform!==""&&(n<i.dragIndex&&jsDD.x>s&&e.style.transform!=="translate3d(0px, 0px, 0px)")){i.targetColumn=i.getColumn(e);BX.Grid.Utils.styleForEach(i.targetColumn,{transition:"300ms",transform:"translate3d(0px, 0px, 0px)"})}}})},_onDragEnd:function(){var t=this;var s=[];[].forEach.call(this.dragColumn,function(s,i){BX.Grid.Utils.collectionSort(s,t.targetColumn[i])});[].forEach.call(this.rowsList,function(t){BX.Grid.Utils.styleForEach(t.cells,{transition:"",transform:""})});this.reinit();[].forEach.call(this.colsList,function(t){s.push(BX.data(t,"name"))});this.parent.getUserOptions().setColumns(s);BX.onCustomEvent(this.parent.getContainer(),"Grid::columnMoved",[this.parent])}}})();
//# sourceMappingURL=cols-sortable.map.js