(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.SettingsWindow=function(t){this.parent=null;this.settingsButton=null;this.applyBottom=null;this.items=null;this.popup=null;this.sourceContent=null;this.lastColumns=null;this.init(t)};BX.Grid.SettingsWindow.prototype={init:function(t){this.parent=t;BX.bind(this.parent.getContainer(),"click",BX.delegate(this._onContainerClick,this))},_onContainerClick:function(t){if(BX.hasClass(t.target,this.parent.settings.get("classSettingsButton"))){this._onSettingsButtonClick(t)}},_onSettingsButtonClick:function(t){this.getPopup().show()},getSourceContent:function(){if(!this.sourceContent){this.sourceContent=BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classSettingsWindow"),true)}return this.sourceContent},getPopupItems:function(){var t;if(!this.items){t=this.getPopup().contentContainer;this.items=BX.Grid.Utils.getByClass(t,this.parent.settings.get("classSettingsWindowColumn"))}return this.items},getColumns:function(){var t=this.getPopupItems();var e=[];var s;t.forEach(function(t){s=BX.Grid.Utils.getByTag(t,"input",true);if(s&&s.checked){e.push(BX.data(t,"name"))}});return e},restoreColumns:function(){var t=this.parent.getParam("DEFAULT_COLUMNS");this.getPopupItems().forEach(function(e){var s=BX.data(e,"name");var n=BX.Grid.Utils.getByClass(e,this.parent.settings.get("classSettingsWindowColumnCheckbox"),true);var i=BX.Grid.Utils.getByClass(e,this.parent.settings.get("classSettingsWindowColumnEditInput"),true);var o=BX.Grid.Utils.getByClass(e,this.parent.settings.get("classSettingsWindowColumnLabel"),true);var a=t[s];n.checked=a.default?true:null;i.value=a.name;BX.html(o,BX.util.htmlspecialchars(a.name))},this)},restoreLastColumns:function(){this.getPopupItems().forEach(function(t){if(this.lastColumns.indexOf(BX.data(t,"name"))===-1){var e=BX.Grid.Utils.getBySelector(t,'input[type="checkbox"]',true);if(e){e.checked=null}}},this)},saveColumns:function(t,e){this.parent.tableFade();this.parent.getUserOptions().setColumns(t,BX.delegate(function(){this.parent.getUserOptions().setColumnsNames(this.getColumnNames(),BX.delegate(function(){this.parent.reloadTable(null,null,e)},this))},this))},resetSettings:function(t){var e,s;this.parent.getActionsPanel().confirmDialog({CONFIRM:true,CONFIRM_MESSAGE:this.parent.arParams.CONFIRM_RESET_MESSAGE},BX.delegate(function(){this.parent.tableFade();BX.addClass(t.buttonNode,"webform-small-button-wait");BX.removeClass(t.buttonNode,"popup-window-button");this.parent.getUserOptions().reset(BX.delegate(function(){this.parent.reloadTable(null,null,BX.delegate(function(){this.restoreColumns();this.lastColumns=this.getColumns();BX.removeClass(t.buttonNode,"webform-small-button-wait");BX.addClass(t.buttonNode,"popup-window-button");t.popupWindow.close()},this))},this))},this))},_onColumnClick:function(t){var e=t.currentTarget;if(BX.hasClass(t.target,this.parent.settings.get("classSettingsWindowColumnEditButton"))){if(!BX.hasClass(e,this.parent.settings.get("classSettingsWindowColumnEditState"))){t.preventDefault();t.stopPropagation();BX.addClass(e,this.parent.settings.get("classSettingsWindowColumnEditState"));var s=BX.Grid.Utils.getByClass(e,this.parent.settings.get("classSettingsWindowColumnEditInput"),true);if(s){s.focus();s.value=s.value}}else{BX.removeClass(e,this.parent.settings.get("classSettingsWindowColumnEditState"));var s=BX.Grid.Utils.getByClass(e,this.parent.settings.get("classSettingsWindowColumnEditInput"),true);var n=BX.Grid.Utils.getByClass(e,this.parent.settings.get("classSettingsWindowColumnLabel"),true);if(n){BX.html(n,BX.util.htmlspecialchars(s.value))}}}},_onColumnKeydown:function(t){if(t.code==="Enter"){var e=t.currentTarget;BX.removeClass(e,this.parent.settings.get("classSettingsWindowColumnEditState"));var s=BX.Grid.Utils.getByClass(e,this.parent.settings.get("classSettingsWindowColumnEditInput"),true);var n=BX.Grid.Utils.getByClass(e,this.parent.settings.get("classSettingsWindowColumnLabel"),true);if(n){BX.html(n,BX.util.htmlspecialchars(s.value))}}},getColumnNames:function(){var t=this.getPopupItems();var e={};t.forEach(function(t){var s=BX.data(t,"name");var n=BX.Grid.Utils.getByClass(t,this.parent.settings.get("classSettingsWindowColumnEditInput"),true);e[s]=BX.util.htmlspecialchars(n.value)},this);return e},getPopup:function(){var t=this;if(!this.popup){var e=BX.create("div");e.innerHTML="<span>"+this.parent.getParam("SETTINGS_TITLE")+" &laquo;"+BX("pagetitle").innerText+"&raquo;</span>";var s=e.firstChild;this.popup=new BX.PopupWindow(this.parent.getContainerId()+"-grid-settings-window",null,{titleBar:s.innerText,autoHide:false,overlay:.6,width:800,closeIcon:true,closeByEsc:true,contentNoPaddings:true,events:{onPopupClose:BX.delegate(function(){this.restoreLastColumns()},this)},buttons:[new BX.PopupWindowButtonLink({text:this.parent.getParam("RESET_DEFAULT"),id:this.parent.getContainerId()+"-grid-settings-reset-button",className:"main-grid-settings-window-actions-item-reset",events:{click:function(){t.resetSettings(this.popupWindow.buttons[1])}}}),new BX.PopupWindowButton({text:this.parent.getParam("APPLY_SETTINGS"),id:this.parent.getContainerId()+"-grid-settings-apply-button",className:"webform-small-button-blue webform-small-button",events:{click:function(){BX.addClass(this.buttonNode,"webform-small-button-wait");BX.removeClass(this.buttonNode,"popup-window-button");t.lastColumns=t.getColumns();t.saveColumns(t.lastColumns,BX.delegate(function(){this.popupWindow.close();BX.removeClass(this.buttonNode,"webform-small-button-wait");BX.addClass(this.buttonNode,"popup-window-button")},this))}}}),new BX.PopupWindowButtonLink({text:this.parent.getParam("CANCEL_SETTINGS"),id:this.parent.getContainerId()+"-grid-settings-cancel-button",events:{click:function(){this.popupWindow.close();t.restoreLastColumns()}}})]});this.popup.setContent(this.getSourceContent());this.lastColumns=this.getColumns();this.getPopupItems().forEach(function(t){BX.bind(t,"click",BX.delegate(this._onColumnClick,this));BX.bind(t,"keydown",BX.delegate(this._onColumnKeydown,this))},this)}return this.popup}}})();
//# sourceMappingURL=settings-window.map.js